<div class="globalContainer">

    <div class="" style="padding: 0 30px 0px 30px;">

      <form [formGroup]="formulario" (ngSubmit)="enviarDatos()">

          <div class="row justify-content-center">
            <!-- Informaci√≥n del Env√≠o -->
            <div class="col-lg-2" *ngIf="!esEnkrgo">
              <div class="card p-4 h-100">
                <h5 class="mb-3">üì¶ Informaci√≥n del Env√≠o</h5>
                
                <div class="mb-3">
                  <label class="form-label">Tipo de Empaque</label>
                  <div class="empaque-search-container position-relative">
                    <input 
                      type="text" 
                      class="form-control" 
                      formControlName="tipoEmpaque" 
                      placeholder="Buscar empaque..."
                      (input)="buscarEmpaques()"
                      (focus)="showMenuEmpaque = true"
                    />
                    <div class="search-icon" *ngIf="buscandoEmpaques">‚ü≥</div>
                    <button 
                      type="button" 
                      class="clear-btn" 
                      *ngIf="empaqueSeleccionado" 
                      (click)="limpiarEmpaque()"
                    >
                      ‚úï
                    </button>
                    
                    <div class="empaque-options" *ngIf="showMenuEmpaque && empaques.length > 0">
                      <div
                        class="empaque-option"
                        *ngFor="let empaque of empaques"
                        (click)="seleccionarEmpaque(empaque)"
                      >
                        <span class="empaque-completo">{{ empaque.codigo }} - {{ empaque.descripcion }}</span>
                      </div>
                    </div>
                    
                    <div class="no-results" *ngIf="showMenuEmpaque && empaques.length === 0 && !buscandoEmpaques && formulario.get('tipoEmpaque')?.value?.length >= 2">
                      No se encontraron empaques
                    </div>
                  </div>
                </div>
                
                <div class="mb-3">
                  <label class="form-label">Tipo de Producto</label>
                  <div class="producto-search-container position-relative">
                    <input 
                      type="text" 
                      class="form-control" 
                      formControlName="tipoProducto" 
                      placeholder="Buscar producto..."
                      (input)="buscarProductos()"
                      (focus)="showMenuProducto = true"
                    />
                    <div class="search-icon" *ngIf="buscandoProductos">‚ü≥</div>
                    <button 
                      type="button" 
                      class="clear-btn" 
                      *ngIf="productoSeleccionado" 
                      (click)="limpiarProducto()"
                    >
                      ‚úï
                    </button>
                    
                    <div class="producto-options" *ngIf="showMenuProducto && productos.length > 0">
                      <div
                        class="producto-option"
                        *ngFor="let producto of productos"
                        (click)="seleccionarProducto(producto)"
                      >
                        <span class="producto-completo">{{ producto.descripcion }}</span>
                      </div>
                    </div>
                    
                    <div class="no-results" *ngIf="showMenuProducto && productos.length === 0 && !buscandoProductos && formulario.get('tipoProducto')?.value?.length >= 2">
                      No se encontraron productos
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Remitente -->
            <div class="remitente col-lg-4 mb-46" style="margin-right: 1rem;">
              <div formGroupName="remitente" class="card p-4 h-100">

                <div class="row g-2 mb-3">
                  <div class="col-5">
                    <h5>Remitente</h5>
                  </div>

                 
                  <div class="col-3 d-flex align-items-center">
                    <button type="button" class="btn btn-outline-danger btn-sm" (click)="limpiarRemitente()" title="Limpiar campos">
                      Limpiar Campos
                    </button>
                  </div>

                  
                  <div class="col-4">
                    <select class="form-select" (change)="cargarRemitenteGuardado($event)">
                      <option value="">-- Seleccion√° un remitente --</option>
                      <option *ngFor="let r of remitentesGuardados" [value]="r.id">{{ r.nombre }} - {{ r.empresa }}</option>
                    </select>
                  </div>
                </div>


               

                <div style="display: grid; gap: 15px;">

                  <div class="section-title">Datos personales</div>
                  <div class="row g-2 mb-3">
                    <div class="col-6"> 
                      <input type="text" class="form-control" formControlName="nombre" placeholder="Nombre Completo">
                      <div class="text-danger" *ngIf="formulario.get('remitente.nombre')?.touched && formulario.get('remitente.nombre')?.invalid">
                        El nombre es requerido.
                      </div>
                    </div>
                    <div class="col-6"><input type="text" class="form-control" formControlName="telefono" placeholder="Tel√©fono">
                      <div class="text-danger" *ngIf="formulario.get('remitente.telefono')?.touched && formulario.get('remitente.telefono')?.invalid">
                        El telefono es requerido.
                      </div>
                    </div>
                    <div class="col-6"><input type="text" class="form-control" formControlName="correo" placeholder="Correo Electr√≥nico">
                      <div class="text-danger" *ngIf="formulario.get('remitente.correo')?.touched && formulario.get('remitente.correo')?.invalid">
                        El correo es requerido.
                      </div></div>
                    <div class="col-6"><input type="text" class="form-control" formControlName="empresa" placeholder="Empresa">
                      <div class="text-danger" *ngIf="formulario.get('remitente.empresa')?.touched && formulario.get('remitente.empresa')?.invalid">
                        La empresa es requerida.
                      </div></div>
                    <div class="col-6"><input type="text" class="form-control" formControlName="rfc" placeholder="RFC"></div>
                    
                  </div>
        
                  <div class="section-title">Direcci√≥n</div>
                  <div class="row g-2 mb-3">
                    <div class="col-6"><input type="text" class="form-control" formControlName="pais" placeholder="Pais">
                      <div class="text-danger" *ngIf="formulario.get('remitente.pais')?.touched && formulario.get('remitente.pais')?.invalid">
                        El pais es requerido.
                      </div>
                    </div>
                    <div class="col-6"><input type="text" class="form-control" formControlName="codigoPostal" placeholder="Codigo Postal">
                      <div class="text-danger" *ngIf="formulario.get('remitente.codigoPostal')?.touched && formulario.get('remitente.codigoPostal')?.invalid">
                        El codigoPostal es requerido.
                      </div>
                    </div>
                    <div class="col-4"><input type="text" class="form-control" formControlName="ciudad" placeholder="Ciudad">
                      <div class="text-danger" *ngIf="formulario.get('remitente.ciudad')?.touched && formulario.get('remitente.ciudad')?.invalid">
                        La ciudad es requerida.
                      </div>
                    </div>
                    <div class="col-4"><input type="text" class="form-control" formControlName="colonia" placeholder="Colonia">
                      <div class="text-danger" *ngIf="formulario.get('remitente.colonia')?.touched && formulario.get('remitente.colonia')?.invalid">
                        La colonia es requerida.
                      </div>
                    </div>
                    <div class="col-4"><input type="text" class="form-control" formControlName="estado" placeholder="Estado">
                      <div class="text-danger" *ngIf="formulario.get('remitente.estado')?.touched && formulario.get('remitente.estado')?.invalid">
                        El estado es requerido.
                      </div>
                    </div>
                    <div class="col-8"><input type="text" class="form-control" formControlName="direccion1" placeholder="Direcci√≥n 1 (calle)">
                      <div class="text-danger" *ngIf="formulario.get('remitente.direccion1')?.touched && formulario.get('remitente.direccion1')?.invalid">
                        El campo es requerido.
                      </div>
                    </div>
                    <div class="col-4"><input type="text" class="form-control" formControlName="numero" placeholder="Num. Ext">
                      <div class="text-danger" *ngIf="formulario.get('remitente.numero')?.touched && formulario.get('remitente.numero')?.invalid">
                        El campo es requerido.
                      </div>
                    </div>
                    <div class="col-12"><input type="text" class="form-control" formControlName="direccion2" placeholder="Direcci√≥n 2 (entre calles y referencias)">
                      <div class="text-danger" *ngIf="formulario.get('remitente.direccion2')?.touched && formulario.get('remitente.direccion2')?.invalid">
                        El campo es requerido.
                      </div>
                    </div>
                  </div>
        
                  <div class="form-check" *ngIf="mostrarGuardarRemitente">
                    <input class="form-check-input" type="checkbox" id="guardarRemitente" formControlName="guardar">
                    <label class="form-check-label" for="guardarRemitente">
                      Guardar remitente
                    </label>
                  </div>


                </div>

              </div>
            </div>
      
            <!-- Destinatario -->
            <div class="destinatario col-lg-4 mb-46" style="margin-left: 1rem;">
              <div formGroupName="destinatario" class="card p-4 h-100">

                <div class="row g-2 mb-3">

                  <div class="col-5">
                    <h5>Destinatario</h5>
                  </div>

                 
                  <div class="col-3 d-flex align-items-center">
                    <button type="button" class="btn btn-outline-danger btn-sm" (click)="limpiarDestinatario()" title="Limpiar campos">
                      Limpiar Campos
                    </button>
                  </div>

                  <div class="col-4">
                    <select class="form-select" (change)="cargarDestinatarioGuardado($event)">
                      <option value="">-- Seleccion√° un destinatario --</option>
                      <option *ngFor="let d of destinatariosGuardados" [value]="d.id">{{ d.nombre }} - {{ d.empresa }}</option>
                    </select>
                  </div>
                </div>

                  <div style="display: grid; gap: 15px;">
            
                      <div class="section-title">Datos personales</div>
                      <div class="row g-2 mb-3">
                        <div class="col-6"> 
                          <input type="text" class="form-control" formControlName="nombre" placeholder="Nombre Completo">
                          <div class="text-danger" *ngIf="formulario.get('destinatario.nombre')?.touched && formulario.get('destinatario.nombre')?.invalid">
                            El nombre es requerido.
                          </div>
                        </div>
                        <div class="col-6"><input type="text" class="form-control" formControlName="telefono" placeholder="Tel√©fono">
                          <div class="text-danger" *ngIf="formulario.get('destinatario.telefono')?.touched && formulario.get('destinatario.telefono')?.invalid">
                            El telefono es requerido.
                          </div>
                        </div>
                        <div class="col-6"><input type="text" class="form-control" formControlName="correo" placeholder="Correo Electr√≥nico">
                          <div class="text-danger" *ngIf="formulario.get('destinatario.correo')?.touched && formulario.get('destinatario.correo')?.invalid">
                            El correo es requerido.
                          </div></div>
                        <div class="col-6"><input type="text" class="form-control" formControlName="empresa" placeholder="Empresa">
                          <div class="text-danger" *ngIf="formulario.get('destinatario.empresa')?.touched && formulario.get('destinatario.empresa')?.invalid">
                            La empresa es requerida.
                          </div></div>
                        <div class="col-6"><input type="text" class="form-control" formControlName="rfc" placeholder="RFC"></div>
                          
                      </div>
              
                      <div class="section-title">Direcci√≥n</div>
                      <div class="row g-2 mb-3">
                        <div class="col-6"><input type="text" class="form-control" formControlName="pais" placeholder="Pais">
                          <div class="text-danger" *ngIf="formulario.get('destinatario.pais')?.touched && formulario.get('destinatario.pais')?.invalid">
                            El pais es requerido.
                          </div>
                        </div>
                        <div class="col-6"><input type="text" class="form-control" formControlName="codigoPostal" placeholder="Codigo Postal">
                          <div class="text-danger" *ngIf="formulario.get('destinatario.codigoPostal')?.touched && formulario.get('destinatario.codigoPostal')?.invalid">
                            El codigoPostal es requerido.
                          </div>
                        </div>
                        <div class="col-4"><input type="text" class="form-control" formControlName="ciudad" placeholder="Ciudad">
                          <div class="text-danger" *ngIf="formulario.get('destinatario.ciudad')?.touched && formulario.get('destinatario.ciudad')?.invalid">
                            La ciudad es requerida.
                          </div>
                        </div>
                        <div class="col-4"><input type="text" class="form-control" formControlName="colonia" placeholder="Colonia">
                          <div class="text-danger" *ngIf="formulario.get('destinatario.colonia')?.touched && formulario.get('destinatario.colonia')?.invalid">
                            La colonia es requerida.
                          </div>
                        </div>
                        <div class="col-4"><input type="text" class="form-control" formControlName="estado" placeholder="Estado">
                          <div class="text-danger" *ngIf="formulario.get('destinatario.estado')?.touched && formulario.get('destinatario.estado')?.invalid">
                            El estado es requerido.
                          </div>
                        </div>
                        <div class="col-8"><input type="text" class="form-control" formControlName="direccion1" placeholder="Direcci√≥n 1 (calle)">
                          <div class="text-danger" *ngIf="formulario.get('destinatario.direccion1')?.touched && formulario.get('destinatario.direccion1')?.invalid">
                            El campo es requerido.
                          </div>
                        </div>
                        <div class="col-4"><input type="text" class="form-control" formControlName="numero" placeholder="Num. Ext">
                          <div class="text-danger" *ngIf="formulario.get('destinatario.numero')?.touched && formulario.get('destinatario.numero')?.invalid">
                            El campo es requerido.
                          </div>
                        </div>
                        <div class="col-12"><input type="text" class="form-control" formControlName="direccion2" placeholder="Direcci√≥n 2 (entre calles y referencias)">
                          <div class="text-danger" *ngIf="formulario.get('destinatario.direccion2')?.touched && formulario.get('destinatario.direccion2')?.invalid">
                            El campo es requerido.
                          </div>
                        </div>
                      </div>
              
                      <div class="form-check" *ngIf="mostrarGuardarDestinatario">
                          <input class="form-check-input" type="checkbox" id="guardarDestinatario" formControlName="guardar">
                          <label class="form-check-label" for="guardarDestinatario">
                          Guardar destinatario
                          </label>
                      </div>

                  </div>
              </div>
            </div>
          </div>

          <div class="d-flex justify-content-center" style="padding-top: 3%; padding-bottom: 1%;"> 
            <button type="submit" class="btn btn-cta">Siguiente</button>
          </div>

        </form>
      </div>

</div>



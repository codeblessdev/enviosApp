<div class="card cotizar-card">
  <h3>Cotizar envío</h3>
  <form (ngSubmit)="onCotizar()" style="gap: 22px; display: grid;">
    
    <div>
      <label class="field-label">Origen</label>
      <div class="input-segment">
        <div class="custom-select">
          <div
            class="selected"
            [class.open]="showMenuOrigen"
            (click)="showMenuOrigen = !showMenuOrigen"
          >
            <img
              [src]="getFlag(paisOrigen.name)"
              alt="Bandera {{ paisOrigen }}"
              class="flag-icon"
            />
            <span class="arrow"></span>
          </div>
        
          <div class="options" *ngIf="showMenuOrigen">
            <div
              class="option"
              *ngFor="let c of countries"
              (click)="seleccionarPaisOrigen(c)"
            >
              <img [src]="c.flag" class="flag-icon" />
              {{ c.name }}
            </div>
          </div>
        </div>
        <input type="text" class="segment-right" [(ngModel)]="cpOrigen" name="cpOrigen" placeholder="Ciudad / CP"/>
      </div>
    </div>

    <div>
      <label class="field-label">Destino</label>
      <div class="input-segment">
        <div class="custom-select">
          <div
            class="selected"
            [class.open]="showMenuDestino"
            (click)="showMenuDestino = !showMenuDestino"
          >
            <img
              [src]="getFlag(paisDestino.name)"
              alt="Bandera {{ paisOrigen }}"
              class="flag-icon"
            />
            <span class="arrow"></span>
          </div>
        
          <div class="options" *ngIf="showMenuDestino">
            <div
              class="option"
              *ngFor="let c of countries"
              (click)="seleccionarPaisDestino(c)"
            >
              <img [src]="c.flag" class="flag-icon" />
              {{ c.name }}
            </div>
          </div>
        </div>

        <input type="text" class="segment-right" [(ngModel)]="cpDestino" name="cpDestino" placeholder="Ciudad / CP"/>
      </div>
    </div>


    <div>
      <label class="field-label">Tipo de empaque</label>
      <div class="empaque-search-container">
        <input 
          type="text" 
          class="full-input" 
          [(ngModel)]="tipoEmpaque" 
          name="tipoEmpaque" 
          placeholder="Buscar empaque por código o descripción..."
          (input)="buscarEmpaques()"
          (focus)="showMenuEmpaque = true"
        />
        <div class="search-icon" *ngIf="buscandoEmpaques">⟳</div>
        <button 
          type="button" 
          class="clear-btn" 
          *ngIf="empaqueSeleccionado" 
          (click)="limpiarEmpaque()"
        >
          ✕
        </button>
        
        <div class="empaque-options" *ngIf="showMenuEmpaque && empaques.length > 0">
          <div
            class="empaque-option"
            *ngFor="let empaque of empaques"
            (click)="seleccionarEmpaque(empaque)"
          >
            <span class="empaque-completo">{{ empaque.codigo }} - {{ empaque.descripcion }}</span>
          </div>
        </div>
        
        <div class="no-results" *ngIf="showMenuEmpaque && empaques.length === 0 && !buscandoEmpaques && tipoEmpaque.length >= 2">
          No se encontraron empaques
        </div>
      </div>
    </div>

    <div>
      <label class="field-label">Tipo de producto</label>
      <div class="producto-search-container">
        <input 
          type="text" 
          class="full-input" 
          [(ngModel)]="tipoProducto" 
          name="tipoProducto" 
          placeholder="Buscar producto por código o descripción..."
          (input)="buscarProductos()"
          (focus)="showMenuProducto = true"
        />
        <div class="search-icon" *ngIf="buscandoProductos">⟳</div>
        <button 
          type="button" 
          class="clear-btn" 
          *ngIf="productoSeleccionado" 
          (click)="limpiarProducto()"
        >
          ✕
        </button>
        
        <div class="producto-options" *ngIf="showMenuProducto && productos.length > 0">
          <div
            class="producto-option"
            *ngFor="let producto of productos"
            (click)="seleccionarProducto(producto)"
          >
            <span class="producto-completo">{{ producto.descripcion }}</span>
          </div>
        </div>
        
        <div class="no-results" *ngIf="showMenuProducto && productos.length === 0 && !buscandoProductos && tipoProducto.length >= 2">
          No se encontraron productos
        </div>
      </div>
    </div>

    <div>

      <div class="dimensiones">
        <div class="dim-box"><input type="number" [(ngModel)]="largo" name="largo" placeholder="Largo"/></div>
        <div class="dim-box"><input type="number" [(ngModel)]="ancho" name="ancho" placeholder="Ancho"/></div>
        <div class="dim-box"><input type="number" [(ngModel)]="alto" name="alto" placeholder="Alto"/></div>
        <div class="dim-box"><input type="number" [(ngModel)]="pesoReal" name="pesoReal" placeholder="Peso"/></div>
      </div>

      <div>

        <div class="peso-volumetrico">
          <strong>Peso volumétrico:</strong>
          {{ pesoVolumetrico | number:'1.2-2' }} kg
        </div>

      </div>

    </div>




 
    <button type="submit" class="btn-cotizar">Cotizar</button>
  </form>
</div>